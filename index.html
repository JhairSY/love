<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carta para Amira üíó</title>

  <style>
    :root{
      --bg1:#0b0a12;
      --bg2:#140f1f;
      --paper:#fff7ee;
      --ink:#2a1d22;
      --rose:#ff4d7d;
      --rose2:#ff7aa2;
      --shadow: 0 20px 70px rgba(0,0,0,.55);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:#fff;
      overflow-x:hidden;

      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(255,77,125,.18), transparent 55%),
        radial-gradient(900px 600px at 85% 30%, rgba(255,122,162,.14), transparent 55%),
        radial-gradient(1000px 800px at 50% 100%, rgba(255,77,125,.08), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
    }

    /* estrellas suaves */
    .stars{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.45;
      background-image:
        radial-gradient(1px 1px at 10% 20%, #fff, transparent),
        radial-gradient(1px 1px at 30% 80%, #fff, transparent),
        radial-gradient(1px 1px at 70% 40%, #fff, transparent),
        radial-gradient(1px 1px at 90% 70%, #fff, transparent),
        radial-gradient(1px 1px at 55% 15%, #fff, transparent),
        radial-gradient(1px 1px at 15% 65%, #fff, transparent),
        radial-gradient(1px 1px at 80% 10%, #fff, transparent),
        radial-gradient(1px 1px at 45% 55%, #fff, transparent);
      background-repeat:no-repeat;
      filter: blur(.1px);
      animation: twinkle 4s ease-in-out infinite;
    }

    @keyframes twinkle{
      0%,100%{opacity:.35}
      50%{opacity:.6}
    }

    .wrap{
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:28px 16px 40px;
      position:relative;
      z-index:1;
    }

    .title{
      text-align:center;
      margin-bottom:18px;
      max-width:900px;
    }

    .title h1{
      margin:0 0 6px;
      font-size:clamp(22px, 4vw, 40px);
      letter-spacing:.4px;
      font-weight:800;
    }

    .title p{
      margin:0;
      opacity:.85;
      font-size:clamp(14px, 2vw, 16px);
    }

    /* GRID PRINCIPAL */
    .stage{
      width:min(1100px, 96vw);
      display:grid;
      gap:18px;
      align-items:start;
    }

    /* Desktop: dos columnas */
    @media (min-width: 920px){
      .stage{
        grid-template-columns: 520px 1fr;
        grid-template-areas:
          "envelope letter"
          "music letter";
        column-gap:24px;
      }
      .envelope-area{ grid-area: envelope; }
      .letter-area{ grid-area: letter; }
      .music-area{ grid-area: music; }
    }

    /* Mobile: SOBRE -> CARTA -> MUSICA (importante) */
    @media (max-width: 919px){
      .stage{
        grid-template-columns: 1fr;
        grid-template-areas:
          "envelope"
          "letter"
          "music";
      }
      .envelope-area{ grid-area: envelope; }
      .letter-area{ grid-area: letter; }
      .music-area{ grid-area: music; }
    }

    /* SOBRE */
    .envelope{
      width:min(520px, 95vw);
      aspect-ratio: 16/10;
      position:relative;
      border-radius:22px;
      transform: translateY(0);
      transition: transform .4s ease;
      filter: drop-shadow(0 30px 55px rgba(0,0,0,.45));
      user-select:none;
      cursor:pointer;
    }

    .envelope:hover{
      transform: translateY(-3px);
    }

    .env-body{
      position:absolute;
      inset:0;
      border-radius:22px;
      background:
        linear-gradient(145deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.14);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    /* parte inferior del sobre */
    .env-bottom{
      position:absolute;
      left:0; right:0; bottom:0;
      height:64%;
      background:
        linear-gradient(180deg, rgba(255,77,125,.18), rgba(255,77,125,.08));
      border-top:1px solid rgba(255,255,255,.08);
    }

    /* tri√°ngulos del sobre */
    .env-left, .env-right, .env-center{
      position:absolute;
      bottom:0;
      width:0; height:0;
      border-style:solid;
      opacity:.9;
    }

    .env-left{
      left:0;
      border-width: 0 0 210px 260px;
      border-color: transparent transparent rgba(255,255,255,.07) transparent;
    }

    .env-right{
      right:0;
      border-width: 0 260px 210px 0;
      border-color: transparent rgba(255,255,255,.06) transparent transparent;
    }

    .env-center{
      left:50%;
      transform:translateX(-50%);
      border-width: 0 260px 210px 260px;
      border-color: transparent transparent rgba(255,255,255,.10) transparent;
      filter: blur(.2px);
    }

    /* tapa del sobre */
    .flap{
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:56%;
      transform-origin: top;
      transform: rotateX(0deg);
      transition: transform .9s cubic-bezier(.2,.9,.2,1);
      z-index:6;
    }

    .flap::before{
      content:"";
      position:absolute;
      inset:0;
      width:0;height:0;
      margin:auto;
      border-style:solid;
      border-width: 0 260px 200px 260px;
      border-color: transparent transparent rgba(255,255,255,.12) transparent;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,.25));
    }

    /* sello */
    .seal{
      position:absolute;
      left:50%;
      top:56%;
      transform: translate(-50%, -50%);
      width:64px;
      height:64px;
      border-radius:999px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 35%),
        radial-gradient(circle at 70% 80%, rgba(0,0,0,.12), transparent 55%),
        linear-gradient(135deg, var(--rose), var(--rose2));
      box-shadow:
        0 18px 30px rgba(0,0,0,.35),
        inset 0 0 0 1px rgba(255,255,255,.22);
      z-index:7;
      display:grid;
      place-items:center;
      transition: transform .45s ease, opacity .45s ease;
    }

    .seal span{
      font-size:28px;
      filter: drop-shadow(0 6px 8px rgba(0,0,0,.25));
    }

    .env-label{
      position:absolute;
      left:18px;
      right:18px;
      bottom:18px;
      z-index:3;
      display:flex;
      justify-content:space-between;
      gap:10px;
      opacity:.9;
      font-size:14px;
      letter-spacing:.2px;
    }

    .tag{
      padding:10px 12px;
      border-radius:14px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(8px);
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 140px;
    }

    .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--rose);
      box-shadow: 0 0 0 6px rgba(255,77,125,.15);
    }

    /* CONTROLES */
    .controls{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      margin-top:12px;
    }

    button{
      border:none;
      cursor:pointer;
      padding:12px 16px;
      border-radius:16px;
      font-weight:800;
      letter-spacing:.2px;
      transition: transform .12s ease, opacity .2s ease, box-shadow .2s ease;
      box-shadow: 0 18px 35px rgba(0,0,0,.35);
    }

    button:active{ transform: translateY(1px) scale(.99); }

    .btn-open{
      background: linear-gradient(135deg, var(--rose), var(--rose2));
      color:white;
    }

    .btn-close{
      background: rgba(0,0,0,.75);
      color:white;
      box-shadow: none;
    }

    .hint{
      opacity:.8;
      font-size:14px;
      text-align:center;
      margin-top:10px;
    }

    /* CARTA */
    .letter{
      width:100%;
      background: var(--paper);
      color: var(--ink);
      border-radius:26px;
      box-shadow: var(--shadow);
      border:1px solid rgba(0,0,0,.06);
      overflow:hidden;

      transform: translateY(20px) scale(.98);
      opacity:0;
      pointer-events:none;
      transition: opacity .7s ease, transform .7s ease;
    }

    .letter.open{
      opacity:1;
      transform: translateY(0) scale(1);
      pointer-events:auto;
    }

    .letter-head{
      padding:22px 26px;
      background:
        radial-gradient(700px 220px at 20% 10%, rgba(255,77,125,.20), transparent 55%),
        radial-gradient(700px 220px at 80% 10%, rgba(255,122,162,.20), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.03), transparent);
      border-bottom:1px dashed rgba(0,0,0,.12);
    }

    .letter-head h2{
      margin:0;
      font-size:clamp(18px, 3vw, 26px);
      font-weight:900;
      letter-spacing:.3px;
    }

    .letter-head small{
      display:block;
      margin-top:6px;
      opacity:.7;
      font-size:13px;
    }

    .letter-body{
      padding:26px;
      font-size:17px;
      line-height:1.75;
    }

    .letter-body p{
      margin:0 0 16px;
    }

    .letter-body p:last-child{
      margin-bottom:0;
    }

    .signature{
      margin-top:18px;
      padding-top:18px;
      border-top:1px dashed rgba(0,0,0,.12);
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .signature .see{
      font-weight:900;
      color: var(--rose);
      font-size:18px;
      letter-spacing:.4px;
    }

    /* estados del sobre */
    .envelope.open .flap{
      transform: rotateX(170deg);
    }

    .envelope.open .seal{
      transform: translate(-50%, -50%) scale(.75);
      opacity:.35;
    }

    /* corazones flotando */
    .heart{
      position:fixed;
      left:50%;
      top:50%;
      font-size:18px;
      pointer-events:none;
      opacity:0;
      transform: translate(-50%, -50%) scale(.7);
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));
      animation: floatUp 1.8s ease forwards;
      z-index:9999;
    }

    @keyframes floatUp{
      0%{
        opacity:0;
        transform: translate(-50%, -50%) scale(.7);
      }
      15%{
        opacity:1;
      }
      100%{
        opacity:0;
        transform: translate(calc(-50% + var(--x)), calc(-50% - 160px)) scale(1.25);
      }
    }

    /* --- CARD TIPO SPOTIFY --- */
    .music-card{
      width:min(520px, 95vw);
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(12px);
      box-shadow: 0 20px 55px rgba(0,0,0,.35);
    }

    .music-top{
      display:flex;
      gap:14px;
      padding:16px;
      align-items:center;
    }

    .cover{
      width:64px;
      height:64px;
      border-radius:18px;
      flex:0 0 auto;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.25), transparent 40%),
        linear-gradient(135deg, rgba(255,77,125,.9), rgba(255,122,162,.65));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 30px rgba(0,0,0,.25);
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
    }

    .cover::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: radial-gradient(circle, rgba(255,255,255,.22), transparent 55%);
      transform: rotate(25deg);
      animation: glow 3.5s ease-in-out infinite;
    }

    @keyframes glow{
      0%,100%{opacity:.45; transform: rotate(25deg) translateY(0)}
      50%{opacity:.75; transform: rotate(25deg) translateY(10px)}
    }

    .cover span{
      position:relative;
      z-index:1;
      font-size:26px;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.25));
    }

    .track{
      flex:1;
      min-width:0;
    }

    .track .title{
      margin:0;
      font-weight:900;
      letter-spacing:.2px;
      font-size:15px;
      text-align:left;
    }

    .track .artist{
      margin:3px 0 0;
      opacity:.75;
      font-size:13px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .music-controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }

    .icon-btn{
      width:44px;
      height:44px;
      border-radius:16px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      cursor:pointer;
      transition: transform .12s ease, background .2s ease;
      user-select:none;
    }

    .icon-btn:active{
      transform: scale(.98);
    }

    .icon-btn:hover{
      background: rgba(255,255,255,.12);
    }

    .icon-btn span{
      font-size:18px;
    }

    .music-bottom{
      padding:0 16px 16px;
      display:grid;
      gap:10px;
    }

    .progress-row{
      display:flex;
      gap:10px;
      align-items:center;
      font-size:12px;
      opacity:.9;
    }

    .progress{
      flex:1;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      cursor:pointer;
      position:relative;
    }

    .bar{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, var(--rose), var(--rose2));
      transition: width .08s linear;
    }

    .vol-row{
      display:flex;
      align-items:center;
      gap:10px;
      opacity:.95;
    }

    .vol-row small{
      opacity:.8;
    }

    input[type="range"]{
      width:100%;
      accent-color: var(--rose);
      cursor:pointer;
    }

    .badge{
      margin:0 16px 16px;
      padding:12px 14px;
      border-radius:18px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
      font-size:13px;
      opacity:.85;
    }

    /* responsive carta */
    @media (max-width:520px){
      .letter-body{ font-size:16px; padding:20px; }
      .letter-head{ padding:18px 20px; }
      .tag{ min-width:auto; }
    }
  </style>
</head>

<body>
  <div class="stars"></div>

  <main class="wrap">
    <div class="title">
      <h1>Una carta para Amira üíó</h1>
      <p>Haz clic en el sobre para abrirla. (Prometo que no ronco‚Ä¶ bueno, a veces üò≠)</p>
    </div>

    <section class="stage">
      <!-- SOBRE -->
      <div class="envelope-area">
        <section class="envelope" id="envelope" aria-label="Sobre de carta">
          <div class="env-body">
            <div class="flap"></div>
            <div class="seal"><span>üíó</span></div>

            <div class="env-bottom"></div>
            <div class="env-left"></div>
            <div class="env-right"></div>
            <div class="env-center"></div>

            <div class="env-label">
              <div class="tag">
                <span class="dot"></span>
                <span>Para: Amira</span>
              </div>
              <div class="tag">
                <span class="dot"></span>
                <span>De: tu novio</span>
              </div>
            </div>
          </div>
        </section>

        <div class="controls">
          <button class="btn-open" id="btnOpen">Abrir carta ‚úâÔ∏è</button>
          <button class="btn-close" id="btnClose" style="display:none;">Cerrar carta</button>
        </div>

        <div class="hint" id="hint">Tip: tambi√©n puedes tocar el sello üíó</div>
      </div>

      <!-- CARTA -->
      <div class="letter-area">
        <article class="letter" id="letter" aria-label="Carta de amor">
          <header class="letter-head">
            <h2>Amira, mi negrita hermosa‚Ä¶</h2>
            <small>Un pedacito de m√≠, escrito para ti.</small>
          </header>

          <!-- IMPORTANTE: TEXTO INTACTO (no cambi√© nada) -->
          <section class="letter-body" id="letterText">
            <p>S√© que √∫ltimamente hemos estado pasando por ciertas dificultades, y m√°s por el tema de la distancia. No podemos hablar como se debe, como quisi√©ramos‚Ä¶ y no s√© si soy solo yo, pero siento que eso nos est√° distanciando un poco. Y te juro que no me gusta sentirme as√≠.</p>

            <p>No quiero perderte, ¬øsabes?<br>Te amo demasiado.</p>

            <p>Amo tu intensidad, como t√∫ le dices. Amo tus dramas, tu voz, tu risa, tu manera de ser‚Ä¶ amo todo eso que te hace t√∫. Y tambi√©n amo hasta esas cosas que a veces parecen ‚Äúmucho‚Äù, porque para m√≠ nunca han sido demasiado‚Ä¶ para m√≠ siempre has sido lo que quiero, lo que me gusta, lo que me hace sentir en casa.</p>

            <p>Y tal vez me he estado descuidando en demostrarte bien cu√°nto te amo. No porque no lo sienta, sino porque a veces me quedo corto, o me conf√≠o, o no encuentro las palabras‚Ä¶ pero la verdad es que te amo con todo lo que soy.</p>

            <p>S√© que te gustan los textos largos, por eso aqu√≠ estoy escribi√©ndote uno. No por presi√≥n, ni porque me lo est√©s pidiendo, sino porque quiero hacerlo‚Ä¶ porque me nace‚Ä¶ porque te amo.</p>

            <p>Y porque yo todav√≠a quiero ese futuro juntos del que siempre hablamos: vivir juntos, casarnos, tener hijos‚Ä¶ formar una vida. Quiz√°s algunos piensen que vamos demasiado r√°pido, pero solo nosotros sabemos todo lo que hemos esperado. Solo nosotros sabemos los a√±os que tuvimos que aguantar, todo lo que nos guardamos, todo lo que se sinti√≥ como ‚Äúcasi pero no‚Äù, todo lo que se qued√≥ en silencio.</p>

            <p>Y s√© que gran parte de eso fue por m√≠‚Ä¶ por mi indecisi√≥n, por mi falta de seguridad, por mis inseguridades tontas, por cosas como mi altura, que ahora me doy cuenta que eran prejuicios rid√≠culos que me estaban frenando. Porque cuando hay amor de verdad, nada de eso importa. Y t√∫ me lo has demostrado desde siempre.</p>

            <p>Hoy, con la discusi√≥n que tuvimos, como te mencion√© en la llamada‚Ä¶ reconozco que estuve mal. Y tambi√©n reconozco que me contradigo cuando digo que quiero que seamos un equipo, una pareja s√≥lida, que se apoya‚Ä¶ pero a la vez a veces act√∫o como si siguiera solo.</p>

            <p>Y es que me he sentido solo tanto tiempo‚Ä¶ cargando con todo yo mismo, aguantando, acostumbr√°ndome a no depender de nadie, a resolverlo todo solo‚Ä¶ que a veces se me olvida que ahora ya no estoy as√≠. Porque ahora te tengo a ti.</p>

            <p>Y no a cualquiera‚Ä¶ te tengo a ti: una mujer maravillosa. Y no es algo de ahora, Amira‚Ä¶ desde hace 8 a√±os estoy enamorado de ti. As√≠ como t√∫ de m√≠. Y ahora que por fin estamos juntos, yo quiero hacerlo bien. De verdad.</p>

            <p>Quisiera una √∫ltima oportunidad para demostr√°rtelo‚Ä¶ para demostrarte que puedo ser ese compa√±ero que mereces. Ese enamorado, ese c√≥mplice, ese mejor amigo. No te lo digo por presi√≥n, ni para que te sientas obligada a nada. Te lo digo porque lo siento. Porque te amo desde siempre. Porque eres el amor de mi vida‚Ä¶ y siempre lo vas a ser.</p>

            <p>Me encantar√≠a despertar cada ma√±ana a tu lado‚Ä¶ y sentir√≠a que soy el hombre m√°s afortunado del mundo. Ese d√≠a que dormimos juntos por primera vez‚Ä¶ yo sent√≠ paz. Sent√≠ felicidad. Sent√≠ algo que no hab√≠a sentido en mucho tiempo. Aunque bueno‚Ä¶ tambi√©n un poquito de miedo por lo que hicimos jajaja ya sabes üò≠‚ù§Ô∏è</p>

            <p>Y yo s√© que tengo que mejorar. S√© que tengo que aprender a expresarme mejor para evitar ciertas cosas que te ponen mal, aunque t√∫ te hagas la fuerte. Te conozco‚Ä¶ a m√≠ no me puedes enga√±ar.</p>

            <p>Yo s√© que a veces me comporto como un idiota la mayor parte del tiempo‚Ä¶ pero te juro que trato de mejorar. No quiero seguir repitiendo errores. No quiero lastimarte. No quiero que lo nuestro se desgaste por cosas que s√≠ se pueden cambiar.</p>

            <p>Quiero hacer las cosas bien. Quiero fortalecer nuestra relaci√≥n. Porque para m√≠ esto es algo muy serio. T√∫ eres la √∫nica mujer que yo quiero tener y amar. Y s√≠, tal vez suene ego√≠sta‚Ä¶ pero mi amor por ti es tan grande que no puedo evitarlo.</p>

            <p>Te amo. Te admiro. Me encanta todo de ti.</p>

            <p>En fin‚Ä¶ espero que est√©s descansando bien, mi amor. Espero que est√©s disfrutando tu viaje con tu familia, que comas rico, que te distraigas, que te r√≠as‚Ä¶ y que aunque estemos lejos, sientas que yo estoy contigo de alguna forma.</p>

            <p>Te amo, mi negrita hermosa. Eres lo mejor que me ha pasado en la vida. Y voy a seguir esforz√°ndome por ser el novio que mereces. No solo por ti‚Ä¶ sino tambi√©n por m√≠. Porque despu√©s de todo, crecer juntos es parte del trabajo en equipo, ¬øno? Apoyarnos, cuidarnos, elegirnos incluso en los momentos dif√≠ciles.</p>

            <p>Bueno‚Ä¶ ahora s√≠ me despido, para que duermas tranquila. No ronques mucho noma xd üò≠üíó</p>

            <div class="signature">
              <div class="see">Te veo‚Ä¶ üíó</div>
            </div>
          </section>
        </article>
      </div>

      <!-- MUSICA (tipo Spotify) -->
      <div class="music-area">
        <div class="music-card" aria-label="Reproductor de m√∫sica">
          <div class="music-top">
            <div class="cover">
              <span>üéµ</span>
            </div>

            <div class="track">
              <p class="title">Amor</p>
              <p class="artist">Emmanuell Cortess</p>
            </div>

            <div class="music-controls">
              <div class="icon-btn" id="btnPlay" title="Play / Pause">
                <span id="playIcon">‚ñ∂Ô∏è</span>
              </div>
            </div>
          </div>

          <div class="music-bottom">
            <div class="progress-row">
              <span id="timeNow">0:00</span>

              <div class="progress" id="progress">
                <div class="bar" id="bar"></div>
              </div>

              <span id="timeTotal">0:00</span>
            </div>

            <div class="vol-row">
              <small>üîä</small>
              <input type="range" id="volume" min="0" max="1" step="0.01" value="0.55">
            </div>
          </div>

          <div class="badge" id="musicNote">
            üíó La m√∫sica empieza sola al abrir la p√°gina. Si no suena, toca Play (los celulares a veces bloquean autoplay).
          </div>
        </div>

        <!-- Audio real -->
        <audio id="audio" preload="auto">
          <source src="amor.mp3" type="audio/mpeg">
          Tu navegador no soporta audio :(
        </audio>
      </div>
    </section>
  </main>

  <script>
    const envelope = document.getElementById("envelope");
    const btnOpen = document.getElementById("btnOpen");
    const btnClose = document.getElementById("btnClose");
    const letter = document.getElementById("letter");
    const hint = document.getElementById("hint");

    // M√∫sica
    const audio = document.getElementById("audio");
    const btnPlay = document.getElementById("btnPlay");
    const playIcon = document.getElementById("playIcon");
    const volume = document.getElementById("volume");
    const timeNow = document.getElementById("timeNow");
    const timeTotal = document.getElementById("timeTotal");
    const progress = document.getElementById("progress");
    const bar = document.getElementById("bar");

    let isOpen = false;

    // corazones
    function spawnHeart(times = 6){
      const emojis = ["üíó","üíñ","üíò","üíï","üíû"];
      for(let i=0; i<times; i++){
        const heart = document.createElement("div");
        heart.className = "heart";
        heart.textContent = emojis[Math.floor(Math.random() * emojis.length)];

        const x = (Math.random() * 180 - 90).toFixed(0) + "px";
        heart.style.setProperty("--x", x);

        heart.style.left = (50 + (Math.random() * 20 - 10)) + "%";
        heart.style.top = (55 + (Math.random() * 10 - 5)) + "%";
        heart.style.fontSize = (16 + Math.random() * 18).toFixed(0) + "px";

        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 1900);
      }
    }

    // --- CARTA ---
    function openLetter(){
      if(isOpen) return;
      isOpen = true;

      envelope.classList.add("open");
      letter.classList.add("open");

      btnOpen.style.display = "none";
      btnClose.style.display = "inline-block";

      hint.textContent = "Listo‚Ä¶ ahora l√©ela con calma, y si sonr√≠es, ya gan√© üòåüíó";
      spawnHeart(10);

      // Scroll suave hacia la carta (en celular es clave)
      setTimeout(() => {
        letter.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 350);
    }

    function closeLetter(){
      if(!isOpen) return;
      isOpen = false;

      envelope.classList.remove("open");
      letter.classList.remove("open");

      btnOpen.style.display = "inline-block";
      btnClose.style.display = "none";

      hint.textContent = "Tip: tambi√©n puedes tocar el sello üíó";
      spawnHeart(4);

      setTimeout(() => {
        envelope.scrollIntoView({ behavior: "smooth", block: "center" });
      }, 250);
    }

    btnOpen.addEventListener("click", openLetter);
    btnClose.addEventListener("click", closeLetter);

    envelope.addEventListener("click", () => {
      if(!isOpen) openLetter();
      else spawnHeart(5);
    });

    // --- MUSICA ---
    function formatTime(sec){
      if(!isFinite(sec)) return "0:00";
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${m}:${String(s).padStart(2,"0")}`;
    }

    function setPlayState(isPlaying){
      playIcon.textContent = isPlaying ? "‚è∏Ô∏è" : "‚ñ∂Ô∏è";
    }

    async function playAudio(){
      try{
        await audio.play();
        setPlayState(true);
      }catch(err){
        // autoplay bloqueado (normal en m√≥viles)
        setPlayState(false);
      }
    }

    function pauseAudio(){
      audio.pause();
      setPlayState(false);
    }

    btnPlay.addEventListener("click", () => {
      if(audio.paused) playAudio();
      else pauseAudio();
    });

    // volumen
    audio.volume = parseFloat(volume.value);
    volume.addEventListener("input", () => {
      audio.volume = parseFloat(volume.value);
    });

    // duraci√≥n total
    audio.addEventListener("loadedmetadata", () => {
      timeTotal.textContent = formatTime(audio.duration);
    });

    // update barra
    audio.addEventListener("timeupdate", () => {
      timeNow.textContent = formatTime(audio.currentTime);
      if(isFinite(audio.duration)){
        const pct = (audio.currentTime / audio.duration) * 100;
        bar.style.width = pct + "%";
      }
    });

    // click en barra para avanzar
    progress.addEventListener("click", (e) => {
      if(!isFinite(audio.duration)) return;

      const rect = progress.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const pct = Math.min(Math.max(x / rect.width, 0), 1);

      audio.currentTime = pct * audio.duration;
    });

    // al terminar
    audio.addEventListener("ended", () => {
      setPlayState(false);
    });

    // --- AUTOPLAY al abrir la p√°gina ---
    window.addEventListener("load", async () => {
      spawnHeart(5);

      // Intento de autoplay
      await playAudio();

      // Si est√° reproduciendo, icono correcto
      setPlayState(!audio.paused);
    });

    // EXTRA: si el usuario abre la carta, intentamos reproducir otra vez
    // (esto ayuda si el navegador bloque√≥ autoplay)
    function tryAgainOnUserGesture(){
      if(audio.paused) playAudio();
    }
    btnOpen.addEventListener("click", tryAgainOnUserGesture);
    envelope.addEventListener("click", tryAgainOnUserGesture);
  </script>
</body>
</html>
